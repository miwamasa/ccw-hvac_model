# ビルエネルギーシミュレーションアプリ

オフィスビルのエネルギー収支と室内環境を月単位で評価するシミュレーションツール

## 📋 目次

- [概要](#概要)
- [機能](#機能)
- [インストール](#インストール)
- [使用方法](#使用方法)
- [モデル仕様](#モデル仕様)
- [テスト](#テスト)
- [ファイル構成](#ファイル構成)
- [技術仕様](#技術仕様)

## 📖 概要

本アプリケーションは、オフィスビルのエネルギー消費と室内環境を月単位で評価するための簡易シミュレーションツールです。

### 主な特徴

- **月単位の簡易計算**: EnergyPlusのような時刻別シミュレーションではなく、月平均値での計算
- **空調システム比較**: 全館空調と個別空調のエネルギー消費を比較
- **負荷内訳の可視化**: 顕熱・潜熱負荷の詳細な内訳を表示
- **プリセット機能**: 最新オフィスと旧式オフィスの設定を用意
- **カスタマイズ可能**: 建物仕様、設備性能、運用条件を自由に設定
- **データ保存**: シミュレーション結果をCSV形式で保存

## ✨ 機能

### 1. 設定管理
- **プリセット選択**: 最新オフィス / 旧式オフィス
- **カスタム設定**: 各パラメータを個別に設定
- **設定保存・読み込み**: JSON形式で設定を保存

### 2. シミュレーション
- **熱負荷計算**
  - 顕熱負荷: 壁・窓貫流熱、日射、内部発熱（照明、OA機器、人体）
  - 潜熱負荷: 人体発生、外気導入
- **エネルギー計算**
  - 全館空調システム（外調機、熱源）
  - 個別空調システム
- **空気線図**: 状態点の計算（エンタルピー、顕熱比）

### 3. 結果表示
- **グラフ表示**
  - 空調システム別エネルギー消費量比較
  - 月別負荷内訳（熱量ベース）
  - 全館空調 vs 個別空調の比較
- **データテーブル**: 詳細な数値結果
- **CSV出力**: 結果データのダウンロード

### 4. 比較機能
- 最新オフィス vs 旧式オフィスの比較表示
- エネルギー削減効果の定量化

## 🚀 インストール

### 必要要件

- Python 3.8以上
- pip

### インストール手順

1. **リポジトリのクローン**
```bash
git clone <repository-url>
cd ccw-hvac_model
```

2. **仮想環境の作成（推奨）**
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

3. **依存パッケージのインストール**
```bash
pip install -r requirements.txt
```

## 💻 使用方法

### アプリケーションの起動

```bash
streamlit run src/app.py
```

ブラウザが自動的に開き、アプリケーションが表示されます（通常は http://localhost:8501）。

### 基本的な使い方

#### 1. 設定タブ

1. **プリセット選択**
   - サイドバーで「最新オフィス」または「旧式オフィス」を選択
   - カスタム設定も可能

2. **建物仕様の設定**
   - 床面積、天井高
   - 壁・窓のU値
   - 日射熱取得係数

3. **設備仕様の設定**
   - 照明電力密度
   - OA機器電力密度
   - 全館空調システムの性能
   - 個別空調システムの性能

4. **月別運用条件の設定**
   - 外気温湿度
   - 室内設定温湿度
   - 居住者数、利用率
   - 運転時間

#### 2. シミュレーションタブ

1. 「🚀 シミュレーション実行」ボタンをクリック
2. 計算完了後、結果サマリーが表示されます

#### 3. 結果タブ

- 月別のグラフが表示されます
- 全館空調と個別空調のエネルギー消費量比較
- 負荷内訳（熱量ベース）

#### 4. データタブ

- 詳細な数値データを確認
- CSVファイルとしてダウンロード

### 比較モード

1. サイドバーで「比較モード（最新 vs 旧式）」にチェック
2. シミュレーションを実行
3. 両方のケースのグラフが重ねて表示されます

### 設定の保存・読み込み

**保存:**
1. 設定完了後、サイドバーの「💾 保存」ボタンをクリック
2. ダウンロードされるJSONファイルを保存

**読み込み:**
1. サイドバーの「📁 読み込み」ボタンをクリック
2. 保存したJSONファイルをアップロード

## 🔬 モデル仕様

### 入力パラメータ

#### 建物仕様
- 床面積 [m²]
- 天井高 [m]
- 壁U値 [W/m²K]
- 窓面積 [m²]
- 窓U値 [W/m²K]
- 日射熱取得係数 [-]

#### 設備仕様
- 照明電力密度 [W/m²]
- OA機器電力密度 [W/m²]
- 全館空調（外調機容量、ファン動力、熱源容量、COP）
- 個別空調（容量、COP、ファン動力）

#### 運用条件（月別）
- 外気温度・湿度
- 室内設定温度・湿度
- 給気温度設定
- 居住者数
- オフィス利用率
- 運転時間

### 計算方法

#### 1. 熱負荷計算

**顕熱負荷 [kW]:**
- 壁貫流熱: Q_wall = U_wall × A_wall × ΔT / 1000
- 窓貫流熱: Q_window = U_window × A_window × ΔT / 1000
- 日射熱: Q_solar = A_window × SHGC × I_solar / 1000
- 照明発熱: Q_light = ρ_light × A_floor × η_occ / 1000
- OA機器発熱: Q_oa = ρ_oa × A_floor × η_occ / 1000
- 人体顕熱: Q_person = 60W/人 × N_occ / 1000

**潜熱負荷 [kW]:**
- 人体潜熱: Q_latent_person = 40W/人 × N_occ / 1000
- 外気潜熱: Q_latent_oa = ρ_air × V_oa × Δx × h_fg / 3600

#### 2. エネルギー消費量計算

**全館空調 [kWh/月]:**
- ファン動力: E_fan = P_fan × t_op
- 熱源: E_chiller = Q_total × t_op / COP

**個別空調 [kWh/月]:**
- ファン動力: E_fan_local = P_fan_local × t_op
- 圧縮機: E_comp = Q_total × t_op / COP_local

#### 3. 空気線図計算

- 飽和水蒸気圧: Antoine式
- 絶対湿度: x = 0.622 × p_v / (p_atm - p_v)
- エンタルピー: h = 1.005 × T + x × (2501 + 1.846 × T)

### モデルの制約事項

- 月平均値を使用（時刻別変動は考慮しない）
- 蓄熱効果は考慮しない
- 自然換気は考慮しない
- 部分負荷特性は簡易化
- 暖房・冷房のCOPは同一と仮定

## 🧪 テスト

### テストの実行

```bash
python src/test_building_energy_model.py
```

### テスト内容

1. **空気線図計算のテスト**
   - 飽和水蒸気圧
   - 絶対湿度
   - エンタルピー

2. **熱負荷計算のテスト**
   - 顕熱負荷計算
   - 潜熱負荷計算
   - 冬季・夏季条件

3. **空調システムモデルのテスト**
   - 全館空調エネルギー計算
   - 個別空調エネルギー計算

4. **統合テスト**
   - 年間シミュレーション
   - 設定の保存・読み込み
   - エネルギーバランス

5. **プリセットのテスト**
   - 最新オフィス設定
   - 旧式オフィス設定
   - プリセット間の比較

### テスト結果の確認

すべてのテストが成功すると、以下のように表示されます：

```
======================================================================
テスト結果サマリー
======================================================================
実行テスト数: 20
成功: 20
失敗: 0
エラー: 0
======================================================================
```

## 📁 ファイル構成

```
ccw-hvac_model/
├── README.md                       # このファイル
├── requirements.txt                # 依存パッケージ
├── pyproject.toml                  # プロジェクト設定
├── .gitignore                      # Git除外設定
├── src/                            # ソースコードディレクトリ
│   ├── app.py                      # メインアプリケーション
│   ├── building_energy_model.py    # コアモデルロジック
│   ├── presets.py                  # プリセット設定
│   ├── sample_run.py               # サンプル実行スクリプト
│   └── test_building_energy_model.py # テストコード
├── doc/                            # ドキュメント
│   ├── QUICKSTART.md               # クイックスタートガイド
│   └── USER_MANUAL.md              # ユーザーマニュアル
└── config/                         # 設定・結果ファイル（自動作成）
```

### 各ファイルの説明

**src/app.py**
- Streamlitベースのユーザーインターフェース
- 設定編集、シミュレーション実行、結果表示、データ保存

**src/building_energy_model.py**
- データクラス（FloorSpec, EquipmentSpec, MonthlyCondition）
- 計算クラス（PsychrometricCalculator, HeatLoadCalculator, HVACSystemModel）
- 統合クラス（BuildingEnergyModel）

**src/presets.py**
- 最新オフィスのプリセット設定
- 旧式オフィスのプリセット設定
- デフォルトの月別運用条件

**src/sample_run.py**
- コマンドラインからの実行例
- 結果の処理とCSV出力
- プリセット設定の利用例

**src/test_building_energy_model.py**
- 各機能のユニットテスト
- 統合テスト
- エネルギーバランステスト

**doc/QUICKSTART.md**
- クイックスタートガイド
- 3ステップでの使用方法

**doc/USER_MANUAL.md**
- 詳細なユーザーマニュアル
- 機能説明、FAQ

## 📊 技術仕様

### 使用技術

- **Python 3.8+**: プログラミング言語
- **Streamlit**: Webアプリケーションフレームワーク
- **Pandas**: データ処理
- **NumPy**: 数値計算
- **Plotly**: インタラクティブグラフ

### データ形式

**設定ファイル（JSON）:**
```json
{
  "floor_spec": {
    "floor_area": 1000.0,
    "ceiling_height": 3.0,
    ...
  },
  "equipment_spec": {
    "lighting_power_density": 8.0,
    ...
  },
  "monthly_conditions": [
    {
      "month": 1,
      "outdoor_temp": 5.2,
      ...
    },
    ...
  ]
}
```

**結果ファイル（CSV）:**
- 月別のエネルギー消費量
- 負荷内訳
- 空気線図の状態点

### パフォーマンス

- 年間シミュレーション実行時間: < 1秒
- メモリ使用量: < 100MB

## 🔧 カスタマイズ

### 新しいプリセットの追加

`presets.py`に新しい関数を追加:

```python
def get_custom_preset() -> Dict:
    """カスタムプリセット"""
    floor_spec = FloorSpec(...)
    equipment_spec = EquipmentSpec(...)
    monthly_conditions = _get_default_monthly_conditions()
    
    return {
        'name': 'カスタムオフィス',
        'description': '説明',
        'floor_spec': floor_spec,
        'equipment_spec': equipment_spec,
        'monthly_conditions': monthly_conditions
    }
```

### 計算ロジックの拡張

`building_energy_model.py`の各クラスを継承して機能を追加:

```python
class ExtendedHeatLoadCalculator(HeatLoadCalculator):
    def calculate_additional_load(self):
        # 新しい負荷計算を追加
        pass
```

## 📝 ライセンス

このプロジェクトはMITライセンスのもとで公開されています。

## 👥 貢献

プルリクエストを歓迎します。大きな変更の場合は、まずissueを開いて変更内容を議論してください。

## 📧 お問い合わせ

質問や提案がある場合は、issueを作成してください。

---

## 📚 参考資料

### 関連規格・基準

- 建築物のエネルギー消費性能の向上に関する法律（建築物省エネ法）
- ASHRAE Standard 55: Thermal Environmental Conditions for Human Occupancy
- ISO 7730: Ergonomics of the thermal environment

### 参考文献

1. 空気調和・衛生工学会編『空気調和・衛生工学便覧』
2. SHASE-M-0003『熱負荷計算法』
3. 日本建築学会『建築設備設計基準』

### 日射量データ

月別平均日射量は東京の標準気象データに基づいています。
他地域で使用する場合は、該当地域のデータに置き換えてください。

---

**バージョン**: 1.0.0  
**最終更新**: 2024年11月
